0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806
0.18128654970760233
0.1871345029239766
0.19298245614035087
0.19883040935672514
0.2046783625730994
0.21052631578947367
0.21637426900584794
0.2222222222222222
0.22807017543859648
0.23391812865497075
0.23976608187134502
0.24561403508771928
0.25146198830409355
0.2573099415204678
0.2631578947368421
0.26900584795321636
0.27485380116959063
0.2807017543859649
0.28654970760233917
0.29239766081871343
0.2982456140350877
0.30409356725146197
0.30994152046783624
0.3157894736842105
0.3216374269005848
0.32748538011695905
0.3333333333333333
0.3391812865497076
0.34502923976608185
0.3508771929824561
0.3567251461988304
0.36257309941520466
0.3684210526315789
0.3742690058479532
0.38011695906432746
0.38596491228070173
0.391812865497076
0.39766081871345027
0.40350877192982454
0.4093567251461988
0.4152046783625731
0.42105263157894735
0.4269005847953216
0.4327485380116959
0.43859649122807015
0.4444444444444444
0.4502923976608187
0.45614035087719296
0.4619883040935672
0.4678362573099415
0.47368421052631576
0.47953216374269003
0.4853801169590643
0.49122807017543857
0.49707602339181284
0.005847953216374269
0.011695906432748537
0.017543859649122806
0.023391812865497075
0.029239766081871343
0.03508771929824561
0.04093567251461988
0.04678362573099415
0.05263157894736842
0.05847953216374269
0.06432748538011696
0.07017543859649122
0.07602339181286549
0.08187134502923976
0.08771929824561403
0.0935672514619883
0.09941520467836257
0.10526315789473684
0.1111111111111111
0.11695906432748537
0.12280701754385964
0.1286549707602339
0.13450292397660818
0.14035087719298245
0.14619883040935672
0.15204678362573099
0.15789473684210525
0.16374269005847952
0.1695906432748538
0.17543859649122806

def fade_edges(image, fade_distance=85):
    height, width = image.shape[:2]
    fade_factor = np.ones((height, width), dtype=np.float32)
    
    for y in range(height):
        for x in range(width):
            fade_factor[y, x] = min(
                fade_factor[y, x],
                (min(y, height - y - 1, x, width - x - 1) / fade_distance)
            )
    
    # Apply the fade factor to each channel of the image
    faded_image = np.zeros_like(image, dtype=np.uint8)
    for channel in range(image.shape[2]):
        faded_image[:, :, channel] = (image[:, :, channel] * fade_factor).astype(np.uint8)
    
    #cv2.imshow("faged_iamge", faded_image)
    #cv2.waitKey(0)
    return faded_image



def merge_patches(patches, origin_H, origin_W, overlap_size=4):
    """
    MERGE PATCHES INTO IMAGE
    THIS PATCHES WEIGHTED AVERAGE DUPLICATED AREA
    
    [INPUT]
    patches: (X, Y, PH, PW, C) : numpy array
    origin_H : H : origin image height, w = origin image width
    overlap_size : duplication factor : default = 4
    
    [OUTPUT]
    image: (H, W, C) : numpy array
    """
    patch_size = patches.shape[2]
    padded_image = np.zeros((origin_H + 2 * overlap_size, origin_W + 2 * overlap_size, 3), dtype=np.float32)
    count_matrix = np.zeros((origin_H + 2 * overlap_size, origin_W + 2 * overlap_size, 3), dtype=np.float32)
    
    for i in range(patches.shape[0]):
        for j in range(patches.shape[1]):
            x_start = i * (patch_size - overlap_size)
            y_start = j * (patch_size - overlap_size)
            
            patches[i][j] = fade_edges(patches[i][j])
            
            for oi in range(patch_size):
                for oj in range(patch_size):
                    padded_image[x_start + oi, y_start + oj] += patches[i, j][oi, oj]
                    count_matrix[x_start + oi, y_start + oj] += 1.0
    
    count_matrix[count_matrix == 0.0] = 1.0
    restored_image = padded_image / count_matrix
    restored_image = restored_image[overlap_size:origin_H + overlap_size, overlap_size:origin_W + overlap_size]
    
    return restored_image.astype(np.uint8)